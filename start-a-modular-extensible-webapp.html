

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/logo.svg">
  <link rel="icon" href="/images/logo.svg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="学习新知，记录心得，分享成果，发现未知。">
  <meta name="author" content="Jat">
  <meta name="keywords" content="">
  
  <title>如何开始一个模块化可扩展的Web App - SinoSky</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"www.sinosky.org","root":"/","version":"1.8.9a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="如何开始一个模块化可扩展的Web App">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2013-04-05 18:58" pubdate>
        2013年4月5日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.8k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      44
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">如何开始一个模块化可扩展的Web App</h1>
            
            <div class="markdown-body">
              <p>Author: <a target="_blank" href="https://plus.google.com/104171418568283484752?rel=author">AlloVince</a></p>
<p>Posted on <a target="_blank" rel="noopener" href="http://avnpc.com/pages/start-a-modular-extensible-webapp">http://avnpc.com/pages/start-a-modular-extensible-webapp</a></p>
<p>&nbsp;</p>
<p>虽然从没有认为自己是一个前端开发者，但不知不觉中也积累下了一些前端开发的经验。正巧之前碰到一道面试题，于是就顺便梳理了一下自己关于Web App的一些思路并整理为本文。</p>
<p>对于很多简单的网站或Web应用来说，引入jQuery以及一些插件，在当前页面内写入简单逻辑已经可以满足大部分需要。但是如果一旦多人开发，应用的复杂程度上升，就会有很多问题开始暴露出来：</p>
<ol>
<li> 数据源一般都与页面分离，那么App启动一般都需要等待数据源读入。</li>
<li> UI交互复杂时，需要将逻辑通过面向对象抽象后才能更好的复用。</li>
<li> 功能间一般都存在依赖关系，需要引入支持依赖关系的模块加载器。</li>
</ol>
<p>那么如何解决这些问题，就以一个简单的订餐App为例，从零开始一个<a target="_blank" rel="noopener" href="http://avnpc.com/pages/start-a-modular-extensible-webapp">模块化可扩展Web App</a>。</p>
<p>这个简单的App基于HTML5 Boilerplate、requireJS、jQuery Mobile、Underscore.js，后端逻辑用<a target="_blank" rel="noopener" href="http://www.jstorage.info/">jStorage</a>模拟实现。完成后的成品<a target="_blank" rel="noopener" href="http://allovince.github.com/webapp-startup/">在此</a>。所有代码可以<a target="_blank" rel="noopener" href="https://github.com/AlloVince/webapp-startup">在github查看</a>。下文将逐一介绍实现的思路与方法。</p>
<p>&nbsp;</p>
<h2 id="从选择一个好模板开始"><a href="#从选择一个好模板开始" class="headerlink" title="从选择一个好模板开始"></a>从选择一个好模板开始</h2><p>开始一个Web项目，HTML的书写总是重中之重，一个好的HTML能从根源上规避大量潜在问题，所以Web App应该全部应用一个标准化的高质量HTML模板，而不是将所有页面交由开发人员自由发挥。</p>
<p>这里推荐使用<a target="_blank" rel="noopener" href="http://html5boilerplate.com/">HTML5 Boilerplate项目</a>作为App的默认模板以及文件路径规范，无论是网站或者富UI的App，都可以采用这个模板作为起步。</p>
<p>可以使用</p>
<pre class="lang:shell " >
git clone git://github.com/h5bp/html5-boilerplate.git
</pre>

<p>或者直接下载<a target="_blank" rel="noopener" href="https://github.com/h5bp/html5-boilerplate">HTML5 Boilerplate项目代码</a>。HTML5 Boilerplate的文件结构如下，</p>
<pre class="lang:plain ">
.
├── css
│   ├── main.css
│   └── normalize.css
├── doc
├── img
├── js
│   ├── main.js
│   ├── plugins.js
│   └── vendor
│       ├── jquery.min.js
│       └── modernizr.min.js
├── .htaccess
├── 404.html
├── index.html
├── humans.txt
├── robots.txt
├── crossdomain.xml
├── favicon.ico
└── [apple-touch-icons]
</pre>

<p>从上向下看</p>
<ul>
<li>  <code>css</code> 用于存放css文件，并内置了<a target="_blank" rel="noopener" href="https://github.com/necolas/normalize.css">Normalize.css</a>作为默认CSS重置手段（其实Normalize.css不能算是CSS reset）。</li>
<li>  <code>doc</code> 存放项目文档</li>
<li>  <code>img</code> 存放项目图片</li>
<li>  <code>js</code> 存放javascript文件，其中第三方类库推荐放在<code>vendor</code>下</li>
<li>  <code>.htaccess</code> 内置了很多对于静态文件在Apache下的优化策略，如果Web服务器不是Apache则可以参考<a target="_blank" rel="noopener" href="https://github.com/h5bp/server-configs">其他Web服务器配置优化</a>。</li>
<li>  <code>404.html</code> 默认的404页面，</li>
<li>  <code>index.html</code> 项目模板</li>
<li>  <code>humans.txt</code> 相对于面向机器人的<code>robots.txt</code>，humans.txt更像是小幽默，这在里可以写关于项目/团队的介绍，或者放置一些彩蛋给那些喜欢对你的应用刨根问底的用户们。</li>
<li>  <code>robots.txt</code> 用于告诉搜索引擎蜘蛛爬行规则</li>
<li>  <code>crossdomain.xml</code> 用于配置<a target="_blank" rel="noopener" href="http://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html">Flash的跨域策略</a></li>
<li>  <code>favicon.ico</code> <code>apple-touch-icon.png</code>等小图标。</li>
</ul>
<p>如果是一个主要面向移动设备，还有更具针对性的<a target="_blank" rel="noopener" href="http://html5boilerplate.com/mobile/">Mobile Boilerplate</a>可供参考。</p>
<p>&nbsp;</p>
<h2 id="制定统一的编码规范"><a href="#制定统一的编码规范" class="headerlink" title="制定统一的编码规范"></a>制定统一的编码规范</h2><p>在正式开始编码之前，无论是多大规模的应用，多少人的团队，一定要有一个统一的规范，才能保证后续的开发不会乱套。</p>
<p>前端规范其实又要分为三部分：HTML、CSS、Javascript应该分别由自己的规范。HTML/CSS主要约定id/class的命名规则、属性的书写顺序。JavaScript可能需要细化到缩进、编码风格、面向对象写法等等。</p>
<p>最省事的方法当然还是参考已有的规范，比如<a target="_blank" rel="noopener" href="http://google-styleguide.googlecode.com/svn/trunk/htmlcssguide.xml">Google的HTML/CSS风格指南</a>、<a target="_blank" rel="noopener" href="http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml">Google的Javascript编码指南</a>等等。</p>
<p>&nbsp;</p>
<h2 id="HTML篇"><a href="#HTML篇" class="headerlink" title="HTML篇"></a>HTML篇</h2><p>HTML5 Boilerplate的模板核心部分不过30行，但是每一行都可谓千锤百炼，可以用最小的消耗解决一些前端的顽固问题：</p>
<h3 id="使用条件注释区分IE浏览器"><a href="#使用条件注释区分IE浏览器" class="headerlink" title="使用条件注释区分IE浏览器"></a>使用条件注释区分IE浏览器</h3><pre class="lang:html " >
<!DOCTYPE html>
<!--[if lt IE 7]>      <html> <![endif]-->
<!--[if IE 7]>         <html> <![endif]-->
<!--[if IE 8]>         <html> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
</pre>

<p>之所以要这样写</p>
<ol>
<li> 可以使用class作为全局条件区分低版本的IE浏览器并进行调整，这显然要优于使用CSS Hack。</li>
<li> 可以避免<a target="_blank" rel="noopener" href="http://webforscher.wordpress.com/2010/05/20/ie-6-slowing-down-ie-8/">IE6条件注释引起的高版本IE文件阻塞问题</a>，原文的解决方法是在前面加一个空白的条件注释，但是这里显然将原本无用空白的条件注释变得有意义了。</li>
<li> 仍然可以通过HTML验证。</li>
<li> 与Modernizr等特征检测类库使用相同的class，更具备通用性。</li>
</ol>
<p><code>no-js</code>标签是需要与Modernizr等类库配合使用的，如果你不想在项目中引入Modernizr，需要在Head部分加入一行使<code>no-js</code>标签变为<code>js</code>，代码来自<a target="_blank" rel="noopener" href="http://paulirish.com/2009/avoiding-the-fouc-v3/">Avoiding the FOUC</a>：</p>
<pre class="lang:html " >
<script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
</pre>

<p>通过上面的条件注释，就可以在CSS中针对不同情况分别处理</p>
<pre class="lang:css " >
.lt-ie7 {} /* IE6等版本时 */
.no-js {} /* JavaScript没有启用时 */
</pre>

<h3 id="meta标签的书写顺序"><a href="#meta标签的书写顺序" class="headerlink" title="meta标签的书写顺序"></a>meta标签的书写顺序</h3><p>为了让浏览器识别正确的编码，meta charset标签应该先于title标签出现。</p>
<p>meta X-UA-Compatible标签可以指定IE8以上版本浏览器以最高级模式渲染文档，同时如果已经安装<a target="_blank" rel="noopener" href="http://www.google.com/chromeframe?quickenable=true">Google Chrome Frame</a>则直接使用Chrome Frame渲染。而指定渲染模式的<a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/cc288325%28VS.85%29.aspx">meta X-UA-Compatible标签同样需要优先出现</a></p>
<pre class="lang:html " >
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title></title>
</pre>
<p>h3&gt;设置移动设备显示窗口宽度</h3></p>
<pre class="lang:html " >
<meta name="viewport" content="width=device-width">
</pre>

<p>这是移动设备专属的标签，具体设置需要根据项目实际情况调整。</p>
<h3 id="使用Modernizr做浏览器差异检测"><a href="#使用Modernizr做浏览器差异检测" class="headerlink" title="使用Modernizr做浏览器差异检测"></a>使用Modernizr做浏览器差异检测</h3><p><a target="_blank" rel="noopener" href="http://modernizr.com/">Modernizr</a>常做前端的应该都不陌生。引入Modernizr后，html标签的<code>no-js</code>将会被自动替换为<code>js</code>，同时Modernizr会向html标签添加代表版本检测结果的class。</p>
<p>对于低版本浏览器的向上兼容需要根据项目实际需求处理，Modernizr也非常周到的给出的<a target="_blank" rel="noopener" href="https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-browser-Polyfills">绝大多数HTML5功能的兼容方法</a>。</p>
<p>&nbsp;</p>
<h2 id="CSS篇"><a href="#CSS篇" class="headerlink" title="CSS篇"></a>CSS篇</h2><h3 id="CSS重置及增强功能"><a href="#CSS重置及增强功能" class="headerlink" title="CSS重置及增强功能"></a>CSS重置及增强功能</h3><p>HTML5 Boilerplate选择<a target="_blank" rel="noopener" href="https://github.com/necolas/normalize.css">Normalize.css</a>重置CSS。如果项目计划引入Twitter Bootstrap、YUI 3这些前端框架的话则可以移除，因为这些框架已经内置了Normalize.css。</p>
<p>同时HTML5 Boilerplate又引入了一个main.css，内置了一些基本的排版样式以及打印样式。</p>
<h3 id="使用LESS或Sass生成CSS"><a href="#使用LESS或Sass生成CSS" class="headerlink" title="使用LESS或Sass生成CSS"></a>使用LESS或Sass生成CSS</h3><p>在复杂应用中，如果还手写CSS的话将是一件痛苦的事情，大量的class前缀，复用样式需要来回copy等等。为了更好的扩展性，这里建议在项目中引入<a target="_blank" rel="noopener" href="http://lesscss.org/">LESS</a>或<a target="_blank" rel="noopener" href="http://sass-lang.com/">Sass</a>。这代表着：</p>
<ul>
<li>  支持变量与简单运算</li>
<li>  支持CSS片段复用</li>
<li>  class/id样式嵌套</li>
</ul>
<p>等一些更像是编程语言的特性。这对于提高开发效率是效果非常明显的。</p>
<p>以LESS为例，简单介绍一下LESS在Windows下如何应用到这个项目中：</p>
<ol>
<li> 下载<a target="_blank" rel="noopener" href="http://nodejs.org/">Nodejs</a>并安装，nodejs会自动将自己加入系统路径。</li>
<li> 在cmd运行 <code>npm install -g less</code></li>
<li> 然后就可以通过lessc指令将less源文件编译为css <code>lessc avnpc.less avnpc.css</code></li>
<li> 如果不使用nodeJs作为后端，最好在写LESS时采用watch模式，每次保存自动编译为css。这里需要安装一个辅助模块recess： <code>npm install -g recess</code> 然后运行watch <code>recess avnpc.less:avnpc.css --watch</code></li>
</ol>
<p>&nbsp;</p>
<h2 id="Javascript篇"><a href="#Javascript篇" class="headerlink" title="Javascript篇"></a>Javascript篇</h2><h3 id="使用requireJS按需加载"><a href="#使用requireJS按需加载" class="headerlink" title="使用requireJS按需加载"></a>使用requireJS按需加载</h3><p>模块加载器的概念可能稍微接触过前端开发的童鞋都不会陌生，通过模块加载器可以有效的解决这些问题：</p>
<ol>
<li> JS文件的依赖关系。</li>
<li> 通过异步加载优化script标签引起的阻塞问题</li>
<li> 可以简单的以文件为单位将功能模块化并实现复用</li>
</ol>
<p>主流的JS模块加载器有<a target="_blank" rel="noopener" href="http://requirejs.org/">requireJS</a>，<a target="_blank" rel="noopener" href="http://seajs.org/docs/">SeaJS</a>等，加载器之间可能会因为遵循的规范不同有微妙的差别，从纯用户的角度出发，之所以选requireJS而不是SeaJS主要是因为：</p>
<ul>
<li>  功能实现上两者相差无几，没有明显的性能差异或重大问题。</li>
<li>  文档丰富程度上，requireJS远远好于SeaJS，就拿最简单的加载jQuery和jQuery插件这回事，虽然两者的实现方法相差无几，但requireJS就有可以直接拿来用的Demo，SeaJS还要读文档自己慢慢折腾。一些问题的解决上，requireJS为关键词也更容易找到答案。</li>
</ul>
<h4 id="requireJS-加载jQuery-jQuery插件"><a href="#requireJS-加载jQuery-jQuery插件" class="headerlink" title="requireJS 加载jQuery + jQuery插件"></a>requireJS 加载jQuery + jQuery插件</h4><p>可能对于一般Web App来说，引入jQuery及相关插件的概率是最大的，requireJS也亲切的给出了相应的解决方案及<a target="_blank" rel="noopener" href="http://requirejs.org/docs/jquery.html">动态加载jQuery及插件</a>的文档及<a target="_blank" rel="noopener" href="http://requirejs.org/docs/download.html#samplejquery">实例代码</a>。</p>
<p>在最新的jQuery1.9.X中，jQuery已经在最后直接将自己注册为一个<a target="_blank" rel="noopener" href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD模块</a>，即是说可以直接被requireJS作为模块加载。如果是加载旧版的jQuery有两种方法：</p>
<p><strong>1. 让jQuery先于requireJS加载</strong> <strong>2. 对jQuery代码稍做一点处理，在jQuery代码包裹一句：</strong></p>
<pre class="lang:javascript " >
define(["jquery"], function($) {
    // $ is guaranteed to be jQuery now */
});
</pre>

<p>requireJS的示例中，直接将requireJS与jQuery合并为一个文件，如果是采用jQuery作为核心库的话推荐这种做法。</p>
<p>同样对于jQuery插件来说也有两种方法</p>
<p><strong>1. 在插件外包裹代码</strong></p>
<pre class="lang:javascript " >
define(["jquery"], function($){
     // Put here the plugin code. 
});
</pre>

<p><strong>2. 在使用reuqireJS代码加载前注册插件（比如在main.js）中</strong></p>
<pre class="lang:javascript " >
requirejs.config({
    "shim": {
        "jquery-cookie"  : ["jquery"]
    }
});
</pre>

<h4 id="requireJS加载第三方类库"><a href="#requireJS加载第三方类库" class="headerlink" title="requireJS加载第三方类库"></a>requireJS加载第三方类库</h4><p>在实例的App中还用到了jQuery以外的第三方类库，如果类库不是一个标准的AMD模块而又不想更改这些类库的代码，同样需要提前进行定义：</p>
<pre class="lang:javascript " >
require.config({
      paths: {
            'underscore': 'vendor/underscore'
      },
      shim: {
          underscore: {
              exports: '_'
          }
      }
});
</pre>

<h4 id="CSS文件的模块化处理"><a href="#CSS文件的模块化处理" class="headerlink" title="CSS文件的模块化处理"></a>CSS文件的模块化处理</h4><p>在requireJS中，模块的概念仅限于JS文件，如果需要加载图片、JSON等非JS文件，requireJS实现了一系列<a target="_blank" rel="noopener" href="http://requirejs.org/docs/plugins.html">加载插件</a>。</p>
<p>但是遗憾的是requireJS官方没有对CSS进行模块化处理，而我们在实际项目中却往往能遇到一些场景，比如一个轮播的图片展示栏，比如高级编辑器等等。几乎所有的富UI组件都会由JS与CSS两部分构成，而CSS之间也存在着模块的概念以及依赖关系。</p>
<p>为了更好的与requireJS整合，这里采用<a target="_blank" rel="noopener" href="https://github.com/guybedford/require-css">require-css</a>来解决CSS的模块化与依赖问题。</p>
<p>require-css是一个requireJS插件，下载后将<code>css.js</code>与<code>normalize.js</code>放于main.js同级即可默认被加载，比如在我们的项目中需要加载jQuery Mobile的css文件，那么可以直接这样调用：</p>
<pre class="lang:javascript " >
require(['jquery', 'css!../css/jquery.mobile-1.3.0.min.css'], function($) {
});
</pre>

<p>不过由于这个CSS本质上是属于jQuery Mobile模块的一部分，更好的做法是将这个CSS文件的定义放在jQuery Mobile的依赖关系中，最终我们的requireJS定义部分为：</p>
<pre class="lang:javascript " >
require.config({
      paths: {
            'jquerymobile': 'vendor/jquery.mobile-1.3.0',
            'jstorage' : 'vendor/jstorage',
            'underscore': 'vendor/underscore'
      },
      shim: {
          jquerymobile : {
            deps: [
                'css!../css/jquery.mobile-1.3.0.min.css'
            ]
          },
          underscore: {
              exports: '_'
          }
      }
});
</pre>

<p>在使用模块时，只需要：</p>
<pre class="lang:javascript " >
require(['jquery', 'underscore', 'jquerymobile', 'jstorage'], function($, _) {
});
</pre>

<p>jQuery Mobile的CSS文件就会被自动加载，这样CSS与JS就被整合为一个模块了。同理其他有复杂依赖关系的模块也可以做类似处理，requireJS会解决依赖关系的逻辑。</p>
<h3 id="数据源的加载与等待"><a href="#数据源的加载与等待" class="headerlink" title="数据源的加载与等待"></a>数据源的加载与等待</h3><p>Web App一般都会动态加载后端的数据，数据格式一般可以是JSON、JSONP也可以直接是一个JS变量。这里以JS变量为例</p>
<pre class="lang:javascript " >
var restaurants = [
    {
        "name": "KFC"
    },
    {
        "name": "7-11"
    },
    {
        "name": "成都小吃"
    }
]
</pre>

<p>载入这段数据:</p>
<pre class="lang:javascript " >
$.getScript('data/restaurants.json', function(e){
    var data = window.restaurants;
    alert(data[0].name); //KFC
});
</pre>

<p>单一的数据源确实很简单，但是往往一个应用中会有多个数据源，比如在这个实例App中UI就需要载入用户信息、餐厅信息、订餐信息三种数据后才能工作。如果仅仅靠多层嵌套回调函数的话，可能代码的耦合就非常重了。</p>
<p>为了解决多个数据加载的问题，我习惯的解决方法是构造一个dataReady事件响应机制。</p>
<pre class="lang:javascript " >
var foodOrder = {
    //数据载入后要执行的函数暂存在这里
    dataReadyFunc : []
    //数据源URL及载入状态
    , dataSource : [
        { url : 'data/restaurants.json', ready : false, data : null },
        { url : 'data/users.json', ready : false, data : null },
        { url : 'data/foods.json', ready : false, data : null }
    ]
    //检查数据源是否全部载入完毕
    , isReady : function(){
        var isReady = true;
        for(var key in this.dataSource){
            if(this.dataSource[key].ready !== true){
                isReady = false;
            }
        }
        return isReady;
    }
    //数据源全部加载完毕，则逐一运行dataReadyFunc中存放的函数
    , callReady : function(){
        if(true === this.isReady()){
            for(var key in this.dataReadyFunc){
                this.dataReadyFunc[key]();
            }
        }
    }
    //供外部调用，会将外部输入的函数暂存在dataReadyFunc中
    , dataReady : function(func){
        if (typeof func !== 'function') {
            return false;
        }
        this.dataReadyFunc.push(func);
    }
    , init : function(){
        var self = this;
        var _initElement = function(key, url){
            $.getScript(url, function(e){
                //每次载入数据后，将数据存放于dataSource中，将ready状态置为true，并调用callReady
                self.dataSource[key].data = window[key];
                self.dataSource[key].ready = true;
                self.callReady();
            });
        }
        for(var key in this.dataSource){
            _initElement(key, this.dataSource[key].url);
        }
    }
}
</pre>

<p>用法为</p>
<pre class="lang:javascript " >
foodOrder.dataReady(function(){
   alert(1);
});
foodOrder.init();
</pre>

<p>dataReady内的alert将会在所有数据载入完毕后开始执行。</p>
<p>这段处理的逻辑并不复杂，将所有要执行的方法通过dataReady暂存起来，等待数据全部加载完毕后再执行，更加复杂的场景此方法仍然通用。</p>
<h3 id="使用JS模板引擎"><a href="#使用JS模板引擎" class="headerlink" title="使用JS模板引擎"></a>使用JS模板引擎</h3><p>数据载入后，最终都会以某种形式显示在页面上。简单情况，我们可能会这样做：</p>
<pre class="lang:javascript " >
$('body').append('<div>' + data.name + '</div>');
</pre>

<p>如果页面逻辑一旦复杂，比如需要有if判断或者多层循环时，这种连接字符串的方式就相形见绌了，而这也就催生出了JS模板引擎。</p>
<p>主流的JS模板引擎有<a target="_blank" rel="noopener" href="http://documentcloud.github.com/underscore/">underscore.js</a>，<a target="_blank" rel="noopener" href="http://jade-lang.com/">Jade</a>，<a target="_blank" rel="noopener" href="http://embeddedjs.com/">EJS</a>等等，可以<a target="_blank" rel="noopener" href="http://engineering.linkedin.com/frontend/client-side-templating-throwdown-mustache-handlebars-dustjs-and-more">横向对比一下这些JS模板引擎的优缺点</a>。</p>
<p>对于相对简单的页面逻辑（只需要支持if和for/each）来说，我更倾向选用轻巧的underscore.js或者<a target="_blank" rel="noopener" href="https://github.com/blueimp/JavaScript-Templates">JavaScript Templates</a>。</p>
<p>在当前例子中，使用underscore.js生成列表就非常简单了，页面模板为：</p>
<pre class="lang:html " >

<script id="tmpl-restaurants" type="text/template">
    <% _.each(data, function(restaurant) { %>*   ["><%- restaurant.name%>](#)
</pre>

<p>调用引擎</p>
<pre class="lang:javascript " >
$("#tmpl-restaurants").replaceWith(
    _.template($("#tmpl-restaurants").html(), {
        data : restaurants
    })
);
</pre>

<h3 id="面向对象与模块化"><a href="#面向对象与模块化" class="headerlink" title="面向对象与模块化"></a>面向对象与模块化</h3><p>通过上面这些工具的组合，我们有了模块的概念，有了模板引擎，有数据的加载。最终还是要通过javascript将这一切组织在一起并加入应用所需要的逻辑。为了能最大限度的复用代码，用面向对象的方式去组织内容是比较好的选择。</p>
<p>JavaScript虽然原生并不支持面向对象，但是依然可以通过很多方式模拟出面向对象的特性。例子中采用了我个人比较喜欢的一种方式是：</p>
<pre class="lang:javascript " >
var foodOrder = function(ui, options){
    //构造函数
    this.init(ui, options);
}
foodOrder.prototype = {
   defaultUI :  {
       form : '#form-order'
   }
   , defaultOptions : {
       debug : false
   }
   , init : function(ui, options){
       this.ui = $.extend({}, this.defaultUI, ui);
       this.options = $.extend({}, this.defaultOptions, options);
   }
}
var order = new foodOrder({
    form : '#real-form'
}, {
    debug : true
});
</pre>

<p>将页面的UI元素以及配置项目抽象出来，在实际构造对象时则可以通过入口参数复写，可以分离整个项目的逻辑与UI，使处理的方式更加灵活。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/programmer/">程序员</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/JavaScript/">JavaScript</a>
                    
                      <a class="hover-with-bg" href="/tags/requireJS/">requireJS</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/show-my-hackintosh.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">晒晒我的黑苹果配置</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/dotcloud-close-free-sevice.html">
                        <span class="hidden-mobile">dotCloud 关闭免费服务</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
